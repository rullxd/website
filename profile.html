<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Pengguna</title>
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <div class="profile-container">
        <h1>Profil Pengguna</h1>

        <!-- Tombol X untuk kembali ke halaman sebelumnya -->
        <button class="close-button" onclick="goBack()">X</button>

        <!-- Formulir Profil -->
        <form id="profileForm" onsubmit="return false;">
            <label>Nama Lengkap:</label>
            <input type="text" id="fullName" placeholder="Nama Lengkap" disabled>

            <label>Email:</label>
            <input type="email" id="email" placeholder="Email" disabled>

            <label>Nomor Telepon:</label>
            <input type="text" id="phone" placeholder="Nomor Telepon" disabled>

            <label>Alamat:</label>
            <textarea id="address" placeholder="Alamat" disabled></textarea>

            <label>Bio:</label>
            <textarea id="bio" placeholder="Tentang Anda" disabled></textarea>

            <!-- Tombol Edit/Simpan -->
            <button type="button" id="toggleButton" onclick="toggleEditMode()">Edit Profil</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userId = localStorage.getItem('userId'); // Ambil userId dari localStorage

            if (!localStorage.getItem('loginToken') || !userId) {
                // Jika token tidak ada, arahkan pengguna ke halaman login
                alert('Anda harus login terlebih dahulu.');
                window.location.href = 'index.html';
            }
            loadUserProfile(userId);
        });


        function loadUserProfile(userId) {
            fetch(`http://localhost:3000/profile?user_id=${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('fullName').value = data.profile.full_name || '';
                        document.getElementById('email').value = data.profile.email || '';
                        document.getElementById('phone').value = data.profile.phone || '';
                        document.getElementById('address').value = data.profile.address || '';
                        document.getElementById('bio').value = data.profile.bio || '';
                    }
                })
                .catch(error => console.error('Error loading profile:', error));

        }

        // Fungsi untuk mengaktifkan/mematikan mode edit
        function toggleEditMode() {
            const inputs = ['fullName', 'email', 'phone', 'address', 'bio'];
            const isDisabled = document.getElementById('fullName').disabled;

            if (isDisabled) {
                // Hapus disabled dari semua input
                inputs.forEach(id => {
                    document.getElementById(id).disabled = false;
                });

                // Ubah teks tombol menjadi "Simpan Profil"
                document.getElementById('toggleButton').innerText = 'Simpan Profil';
                document.getElementById('toggleButton').setAttribute('onclick', 'saveProfile(event)');
            }
        }
        function goBack() {
            window.history.back();
        }

        // Fungsi untuk menyimpan data profil
        function saveProfile(event) {
            event.preventDefault();

            const userId = localStorage.getItem('userId');
            if (!userId) {
                alert('Anda harus login terlebih dahulu.');
                window.location.href = 'login.html';
                return;
            }

            const profileData = {
                user_id: userId,
                full_name: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                bio: document.getElementById('bio').value
            };

            fetch('http://localhost:3000/edit-profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(profileData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Profil berhasil disimpan!');
                        // Mengunci kembali input form setelah menyimpan
                        document.getElementById('fullName').disabled = true;
                        document.getElementById('email').disabled = true;
                        document.getElementById('phone').disabled = true;
                        document.getElementById('address').disabled = true;
                        document.getElementById('bio').disabled = true;

                        // Ubah tombol kembali menjadi "Edit Profil"
                        document.getElementById('toggleButton').innerText = 'Edit Profil';
                        document.getElementById('toggleButton').setAttribute('onclick', 'toggleEditMode()');
                    } else {
                        alert('Gagal menyimpan profil.');
                    }
                })
                .catch(error => console.error('Error saving profile:', error));
        }


        // Muat profil saat halaman dimuat
        document.addEventListener('DOMContentLoaded', loadProfile);
    </script>

    <script>
        // Fungsi untuk mengubah tema
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');

            if (currentTheme === 'dark') {
                html.removeAttribute('data-theme');
            } else {
                html.setAttribute('data-theme', 'dark');
            }

            // Simpan preferensi tema ke localStorage
            localStorage.setItem('theme', html.getAttribute('data-theme') || 'light');
        }

        // Fungsi untuk memuat tema yang tersimpan
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        }

        // Panggil loadSavedTheme saat halaman dimuat
        document.addEventListener('DOMContentLoaded', loadSavedTheme);
    </script>

</body>

</html>